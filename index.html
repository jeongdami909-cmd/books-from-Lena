<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Books from Lena</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Noto+Serif+KR:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --paper: #f1f8f1;
  --paper2: #fafffa;
  --aged: #d5e6d5;
  --ink: #1e2b1e;
  --rust: #3e6b3a;
  --gold: #8cb38c;
  --muted: #6b7a6b;
  --soft: #9db89d;
  --card-bg: #ffffff;
  --shadow: 0 4px 20px rgba(30,43,30,0.08);
  --overlay: rgba(30,43,30,0.6);
}
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family: 'Noto Serif KR', serif; background: var(--paper); color: var(--ink); min-height: 100vh; padding-bottom: 50px; }

/* HEADER */
.site-header { padding: 40px 20px; border-bottom: 1px solid var(--aged); display: flex; align-items: center; justify-content: space-between; max-width: 800px; margin: 0 auto; }
.site-title { font-family:'Playfair Display',serif; font-size: 2.2rem; font-weight:700; color: var(--rust); }
.btn-add { background: var(--rust); color: white; border: none; padding: 12px 20px; border-radius: 4px; cursor: pointer; font-family: inherit; font-size: 0.9rem; }

/* FILTER */
.filter-bar { padding: 20px; display: flex; gap: 10px; justify-content: center; border-bottom: 1px solid var(--aged); }
.tag-btn { background: white; border: 1px solid var(--aged); color: var(--muted); padding: 6px 16px; border-radius: 20px; cursor: pointer; font-size: 13px; }
.tag-btn.active { background: var(--rust); color: white; border-color: var(--rust); }

/* LIST & CARD */
.book-list { max-width: 800px; margin: 30px auto; padding: 0 20px; display: flex; flex-direction: column; gap: 25px; }
.book-card { background: var(--card-bg); border: 1px solid var(--aged); border-radius: 8px; box-shadow: var(--shadow); padding: 25px; position: relative; }
.book-card::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 6px; background: var(--rust); border-radius: 8px 0 0 8px; }
.card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; }
.book-title { font-size: 1.5rem; font-weight: 700; }
.region-tag { font-size: 12px; color: var(--rust); font-weight: 500; }
.content-box { background: rgba(213,230,213,0.2); padding: 15px; border-radius: 4px; margin: 15px 0; line-height: 1.8; font-size: 14.5px; white-space: pre-wrap; }

/* 사진 박스: 주소가 잘못되어도 깨진 아이콘이 안 보이도록 설정 */
.photo-box img { width: 100%; border-radius: 4px; margin-top: 10px; border: 1px solid var(--aged); display: block; }
.photo-box img[src=""], .photo-box img:not([src]) { display: none; }

.card-btns { display: flex; gap: 10px; justify-content: flex-end; margin-top: 10px; }
.btn-sm { background: none; border: 1px solid var(--aged); color: var(--muted); padding: 5px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; }

/* MODAL: 글쓰기 칸 크기 확대 */
.modal-bg { display: none; position: fixed; inset: 0; background: var(--overlay); z-index: 1000; align-items: center; justify-content: center; padding: 15px; }
.modal-bg.open { display: flex; }
.modal { background: var(--paper2); width: 100%; max-width: 500px; padding: 25px; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); max-height: 95vh; overflow-y: auto; }
.modal h2 { margin-bottom: 15px; font-family: 'Playfair Display', serif; color: var(--rust); }
input, select { width: 100%; padding: 12px; margin-bottom: 12px; border: 1px solid var(--aged); border-radius: 4px; font-family: inherit; background: white; }

/* 텍스트 입력창 높이 확대 */
textarea { width: 100%; padding: 12px; margin-bottom: 12px; border: 1px solid var(--aged); border-radius: 4px; font-family: inherit; background: white; min-height: 300px; resize: vertical; }

</style>
</head>
<body>

<header class="site-header">
  <div>
    <h1 class="site-title">Books from Lena</h1>
    <p style="font-size: 13px; color: var(--soft);">나만의 연둣빛 서재 기록</p>
  </div>
  <button class="btn-add" onclick="openModal()">＋ 새 기록</button>
</header>

<div class="filter-bar">
  <button class="tag-btn active" onclick="filterBy('전체', this)">전체</button>
  <button class="tag-btn" onclick="filterBy('아시아', this)">아시아</button>
  <button class="tag-btn" onclick="filterBy('유럽', this)">유럽</button>
  <button class="tag-btn" onclick="filterBy('미국', this)">미국</button>
</div>

<main class="book-list" id="bookList"></main>

<div class="modal-bg" id="modalBg">
  <div class="modal">
    <h2 id="modalTitle">기록하기</h2>
    <input type="text" id="f-title" placeholder="책 제목">
    <select id="f-region">
      <option value="아시아">아시아</option>
      <option value="유럽">유럽</option>
      <option value="미국">미국</option>
      <option value="기타">기타</option>
    </select>
    <textarea id="f-text" placeholder="발췌 및 소감을 자유롭게 적어보세요."></textarea>
    <input type="text" id="f-img" placeholder="이미지 주소 (JPG, PNG 등)">
    <div style="display: flex; gap: 10px;">
      <button class="btn-add" style="flex: 1;" onclick="handleSave()">저장</button>
      <button class="btn-add" style="flex: 1; background: var(--muted);" onclick="closeModal()">취소</button>
    </div>
  </div>
</div>

<script>
let books = JSON.parse(localStorage.getItem('lena_library') || '[]');
let editId = null;

// 초기 샘플 데이터
if(books.length === 0) {
    books = [{id: 1, title: '처첩성군', region: '아시아', text: '쑤퉁의 소설. 1920년대 중국 가부장제의 비극을 다룹니다.', img: ''}];
    localStorage.setItem('lena_library', JSON.stringify(books));
}

function openModal(id = null) {
    editId = id;
    if(id) {
        const b = books.find(item => item.id === id);
        document.getElementById('f-title').value = b.title;
        document.getElementById('f-region').value = b.region;
        document.getElementById('f-text').value = b.text;
        document.getElementById('f-img').value = b.img;
        document.getElementById('modalTitle').innerText = "기록 수정하기";
    } else {
        document.getElementById('f-title').value = '';
        document.getElementById('f-region').value = '아시아';
        document.getElementById('f-text').value = '';
        document.getElementById('f-img').value = '';
        document.getElementById('modalTitle').innerText = "새 기록 남기기";
    }
    document.getElementById('modalBg').classList.add('open');
}

function closeModal() { document.getElementById('modalBg').classList.remove('open'); }

function handleSave() {
    const title = document.getElementById('f-title').value;
    const region = document.getElementById('f-region').value;
    const text = document.getElementById('f-text').value;
    const img = document.getElementById('f-img').value;

    if(!title) return alert("제목을 입력해 주세요.");

    if(editId) {
        const idx = books.findIndex(b => b.id === editId);
        books[idx] = { id: editId, title, region, text, img };
    } else {
        books.unshift({ id: Date.now(), title, region, text, img });
    }
    
    localStorage.setItem('lena_library', JSON.stringify(books));
    render();
    closeModal();
}

function deleteBook(id) {
    if(!confirm("이 기록을 삭제할까요?")) return;
    books = books.filter(b => b.id !== id);
    localStorage.setItem('lena_library', JSON.stringify(books));
    render();
}

function render(filter = '전체') {
    const list = document.getElementById('bookList');
    list.innerHTML = '';
    const filtered = filter === '전체' ? books : books.filter(b => b.region === filter);

    filtered.forEach(b => {
        list.innerHTML += `
            <div class="book-card">
                <div class="card-header">
                    <h2 class="book-title">${b.title}</h2>
                    <span class="region-tag">[${b.region}]</span>
                </div>
                <div class="content-box">${b.text}</div>
                ${b.img ? `<div class="photo-box"><img src="${b.img}" onerror="this.style.display='none'"></div>` : ''}
                <div class="card-btns">
                    <button class="btn-sm" onclick="openModal(${b.id})">수정</button>
                    <button class="btn-sm" style="color:#c0392b; border-color:#d5e6d5" onclick="deleteBook(${b.id})">삭제</button>
                </div>
            </div>
        `;
    });
}

function filterBy(region, btn) {
    document.querySelectorAll('.tag-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    render(region);
}

render();
</script>
</body>
</html>
